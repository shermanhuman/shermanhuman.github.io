<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sherman Boyd - C64 Resume</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=VT323&display=swap">
    <style>
        body {
            background-color: #4040e0;
            color: #a0a0ff;
            font-family: 'VT323', monospace;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        #app {
            width: 100%;
            max-width: 640px;
            white-space: pre-wrap;
        }
        .selected {
            background-color: #a0a0ff;
            color: #4040e0;
        }
        .clickable {
            cursor: pointer;
        }
        .menu-item {
            outline: none;
        }
    </style>
</head>
<body>
    <div id="app">
        <div v-if="currentScreen === 'boot'">
            {{ bootSequence }}
        </div>

        <div v-else-if="currentScreen === 'menu'" @keydown="handleKeydown">
            <div v-for="(item, index) in menuItems" :key="index" 
                 :class="{ selected: index === selectedIndex, clickable: true, 'menu-item': true }"
                 @click="handleMenuSelection(item.action)"
                 tabindex="0"
                 :ref="el => { if (index === 0) firstMenuItemRef = el }">
                {{ index + 1 }}. {{ item.label }}
            </div>
            <div style="margin-top: 20px;">USE ARROW KEYS TO NAVIGATE, ENTER TO SELECT, OR PRESS NUMBER KEY</div>
        </div>

        <div v-else-if="currentScreen === 'resume'">
            <div v-html="parsedResumeContent"></div>
            <div @click="returnToMenu" class="clickable" style="margin-top: 20px;" tabindex="0" ref="returnButtonRef">RETURN TO MAIN MENU</div>
        </div>

        <div v-else-if="currentScreen === 'blogMenu'" @keydown="handleKeydown">
            <h2>BLOG POSTS:</h2>
            <div v-for="(post, index) in blogPosts" :key="index" 
                 :class="{ selected: index === selectedIndex, clickable: true, 'menu-item': true }"
                 @click="handleBlogSelection(index)"
                 tabindex="0"
                 :ref="el => { if (index === 0) firstBlogItemRef = el }">
                {{ index + 1 }}. {{ post.title }}
            </div>
            <div :class="{ selected: selectedIndex === blogPosts.length, clickable: true, 'menu-item': true }"
                 @click="returnToMenu"
                 tabindex="0">
                {{ blogPosts.length + 1 }}. RETURN TO MAIN MENU
            </div>
            <div style="margin-top: 20px;">USE ARROW KEYS TO NAVIGATE, ENTER TO SELECT, OR PRESS NUMBER KEY</div>
        </div>

        <div v-else-if="currentScreen === 'blogPost'">
            <div v-html="parsedBlogContent"></div>
            <div @click="returnToBlogMenu" class="clickable" style="margin-top: 20px;" tabindex="0" ref="returnButtonRef">RETURN TO BLOG MENU</div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue;

        createApp({
            setup() {
                const currentScreen = ref('boot');
                const bootSequence = ref('');
                const menuItems = ref([
                    { label: 'VIEW RESUME', action: 'viewResume' },
                    { label: 'VIEW BLOG', action: 'viewBlog' },
                ]);
                const selectedIndex = ref(0);
                const resumeContent = ref('');
                const blogPosts = ref([]);
                const blogContent = ref('');
                const firstMenuItemRef = ref(null);
                const firstBlogItemRef = ref(null);
                const returnButtonRef = ref(null);

                const simulateBoot = async () => {
                    const bootLines = [
                        "**** COMMODORE 64 BASIC V2 ****",
                        "64K RAM SYSTEM  38911 BASIC BYTES FREE",
                        "READY.",
                        "LOAD \"MENU\",8,1",
                        "SEARCHING FOR MENU",
                        "LOADING",
                        "READY.",
                        "RUN"
                    ];

                    for (let i = 0; i < bootLines.length; i++) {
                        bootSequence.value += bootLines[i] + '\n';
                        if (i >= 3) {
                            await new Promise(resolve => setTimeout(resolve, 1000));
                        }
                    }
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    currentScreen.value = 'menu';
                    nextTick(() => {
                        if (firstMenuItemRef.value) {
                            firstMenuItemRef.value.focus();
                        }
                    });
                };

                const handleKeydown = (event) => {
                    const maxIndex = currentScreen.value === 'menu' ? menuItems.value.length - 1 : blogPosts.value.length;
                    switch (event.key) {
                        case 'ArrowUp':
                            event.preventDefault();
                            selectedIndex.value = (selectedIndex.value - 1 + maxIndex + 1) % (maxIndex + 1);
                            break;
                        case 'ArrowDown':
                            event.preventDefault();
                            selectedIndex.value = (selectedIndex.value + 1) % (maxIndex + 1);
                            break;
                        case 'Enter':
                            event.preventDefault();
                            if (currentScreen.value === 'menu') {
                                handleMenuSelection(menuItems.value[selectedIndex.value].action);
                            } else if (currentScreen.value === 'blogMenu') {
                                handleBlogSelection(selectedIndex.value);
                            }
                            break;
                        default:
                            if (event.key >= '1' && event.key <= (maxIndex + 1).toString()) {
                                const index = parseInt(event.key) - 1;
                                if (index <= maxIndex) {
                                    selectedIndex.value = index;
                                    if (currentScreen.value === 'menu') {
                                        handleMenuSelection(menuItems.value[index].action);
                                    } else if (currentScreen.value === 'blogMenu') {
                                        handleBlogSelection(index);
                                    }
                                }
                            }
                    }
                };

                const handleMenuSelection = async (action) => {
                    if (action === 'viewResume') {
                        await loadResume();
                    } else if (action === 'viewBlog') {
                        await loadBlogPosts();
                    }
                };

                const loadResume = async () => {
                    currentScreen.value = 'boot';
                    bootSequence.value = 'LOAD "RESUME",8,1\nSEARCHING FOR RESUME\nLOADING\n';
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    try {
                        const response = await fetch('resume.md');
                        resumeContent.value = await response.text();
                        currentScreen.value = 'resume';
                        nextTick(() => {
                            if (returnButtonRef.value) {
                                returnButtonRef.value.focus();
                            }
                        });
                    } catch (error) {
                        console.error('Error loading resume:', error);
                        bootSequence.value += 'ERROR LOADING RESUME\n';
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        currentScreen.value = 'menu';
                        nextTick(() => {
                            if (firstMenuItemRef.value) {
                                firstMenuItemRef.value.focus();
                            }
                        });
                    }
                };

                const loadBlogPosts = async () => {
                    currentScreen.value = 'boot';
                    bootSequence.value = 'LOAD "BLOG",8,1\nSEARCHING FOR BLOG\nLOADING\n';
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    try {
                        const posts = ['first-post.md', 'second-post.md', 'third-post.md'];
                        blogPosts.value = await Promise.all(posts.map(async (post) => {
                            const response = await fetch(post);
                            const content = await response.text();
                            const title = content.split('\n')[0].replace('# ', '');
                            return { title, filename: post };
                        }));
                        currentScreen.value = 'blogMenu';
                        selectedIndex.value = 0;
                        nextTick(() => {
                            if (firstBlogItemRef.value) {
                                firstBlogItemRef.value.focus();
                            }
                        });
                    } catch (error) {
                        console.error('Error loading blog posts:', error);
                        bootSequence.value += 'ERROR LOADING BLOG POSTS\n';
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        currentScreen.value = 'menu';
                        nextTick(() => {
                            if (firstMenuItemRef.value) {
                                firstMenuItemRef.value.focus();
                            }
                        });
                    }
                };

                const handleBlogSelection = async (index) => {
                    if (index === blogPosts.value.length) {
                        returnToMenu();
                    } else {
                        await loadBlogPost(blogPosts.value[index].filename);
                    }
                };

                const loadBlogPost = async (filename) => {
                    currentScreen.value = 'boot';
                    bootSequence.value = `LOAD "${filename}",8,1\nSEARCHING FOR ${filename}\nLOADING\n`;
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    try {
                        const response = await fetch(filename);
                        blogContent.value = await response.text();
                        currentScreen.value = 'blogPost';
                        nextTick(() => {
                            if (returnButtonRef.value) {
                                returnButtonRef.value.focus();
                            }
                        });
                    } catch (error) {
                        console.error('Error loading blog post:', error);
                        bootSequence.value += 'ERROR LOADING BLOG POST\n';
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        currentScreen.value = 'blogMenu';
                        nextTick(() => {
                            if (firstBlogItemRef.value) {
                                firstBlogItemRef.value.focus();
                            }
                        });
                    }
                };

                const returnToMenu = () => {
                    currentScreen.value = 'menu';
                    selectedIndex.value = 0;
                    nextTick(() => {
                        if (firstMenuItemRef.value) {
                            firstMenuItemRef.value.focus();
                        }
                    });
                };

                const returnToBlogMenu = () => {
                    currentScreen.value = 'blogMenu';
                    selectedIndex.value = 0;
                    nextTick(() => {
                        if (firstBlogItemRef.value) {
                            firstBlogItemRef.value.focus();
                        }
                    });
                };

                const parsedResumeContent = computed(() => marked(resumeContent.value));
                const parsedBlogContent = computed(() => marked(blogContent.value));

                onMounted(() => {
                    simulateBoot();
                });

                return {
                    currentScreen,
                    bootSequence,
                    menuItems,
                    selectedIndex,
                    resumeContent,
                    blogPosts,
                    blogContent,
                    handleKeydown,
                    handleMenuSelection,
                    handleBlogSelection,
                    returnToMenu,
                    returnToBlogMenu,
                    parsedResumeContent,
                    parsedBlogContent,
                    firstMenuItemRef,
                    firstBlogItemRef,
                    returnButtonRef,
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
