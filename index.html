<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C64 Digital Resume</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #4040e0;
            color: #a0a0ff;
            font-family: 'VT323', monospace;
            font-size: 16px;
            line-height: 1.2;
            margin: 0;
            padding: 20px;
            height: 100vh;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        #screen {
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .menu-item {
            cursor: pointer;
        }
        .menu-item:hover, .menu-item:focus {
            background-color: #a0a0ff;
            color: #4040e0;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="screen">
            {{ screenContent }}
        </div>
    </div>

    <script src="https://unpkg.com/vue@3.4.34/dist/vue.global.prod.js"></script>
    <script>
        const { createApp, ref, onMounted, watch } = Vue;

        const app = createApp({
            setup() {
                const screenContent = ref('');
                const currentState = ref('boot');
                const menuItems = ref([]);
                const selectedMenuItem = ref(0);
                const resumeContent = ref('');
                const blogPosts = ref([]);
                const currentBlogPost = ref(null);

                const bootSequence = [
                    "**** COMMODORE 64 BASIC V2 ****",
                    "64K RAM SYSTEM  38911 BASIC BYTES FREE",
                    "READY.",
                    "LOAD \"MENU\",8,1",
                    "SEARCHING FOR MENU",
                    "LOADING",
                    "READY."
                ];

                const typeText = async (text, delay = 50) => {
                    for (let char of text) {
                        screenContent.value += char;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                    screenContent.value += '\n';
                };

                const loadContent = async (content) => {
                    await typeText(`LOAD "${content}",8,1`);
                    await typeText(`SEARCHING FOR ${content}`);
                    await typeText("LOADING");
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    await typeText("READY.");
                };

                const showMainMenu = () => {
                    screenContent.value = "MAIN MENU:\n\n";
                    menuItems.value = ["VIEW RESUME", "VIEW BLOG"];
                    menuItems.value.forEach((item, index) => {
                        screenContent.value += `${index + 1}. ${item}\n`;
                    });
                    currentState.value = 'mainMenu';
                };

                const showResume = async () => {
                    await loadContent("RESUME");
                    screenContent.value = resumeContent.value + "\n\nPRESS ANY KEY TO RETURN TO MAIN MENU";
                    currentState.value = 'resume';
                };

                const showBlogList = async () => {
                    await loadContent("BLOG");
                    screenContent.value = "BLOG POSTS:\n\n";
                    blogPosts.value.forEach((post, index) => {
                        screenContent.value += `${index + 1}. ${post.title}\n`;
                    });
                    screenContent.value += "\nPRESS NUMBER TO SELECT POST OR 'M' TO RETURN TO MAIN MENU";
                    currentState.value = 'blogList';
                };

                const showBlogPost = async (index) => {
                    const post = blogPosts.value[index];
                    await loadContent(post.title);
                    screenContent.value = `${post.title}\n\n${post.content}\n\nPRESS ANY KEY TO RETURN TO BLOG LIST`;
                    currentState.value = 'blogPost';
                };

                const handleKeyPress = (event) => {
                    if (currentState.value === 'mainMenu') {
                        if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {
                            selectedMenuItem.value = (selectedMenuItem.value + 1) % menuItems.value.length;
                            showMainMenu();
                        } else if (event.key === 'Enter' || event.key === '1' || event.key === '2') {
                            const selection = event.key === '1' ? 0 : event.key === '2' ? 1 : selectedMenuItem.value;
                            if (selection === 0) {
                                showResume();
                            } else {
                                showBlogList();
                            }
                        }
                    } else if (currentState.value === 'resume' || currentState.value === 'blogPost') {
                        showMainMenu();
                    } else if (currentState.value === 'blogList') {
                        if (event.key === 'm' || event.key === 'M') {
                            showMainMenu();
                        } else if (event.key >= '1' && event.key <= blogPosts.value.length.toString()) {
                            showBlogPost(parseInt(event.key) - 1);
                        }
                    }
                };

                onMounted(async () => {
                    window.addEventListener('keydown', handleKeyPress);

                    for (let line of bootSequence) {
                        if (line.startsWith("LOAD")) {
                            await typeText(line);
                        } else {
                            screenContent.value += line + "\n";
                            await new Promise(resolve => setTimeout(resolve, 500));
                        }
                    }

                    // Fetch resume content
                    const resumeResponse = await fetch('resume.md');
                    resumeContent.value = await resumeResponse.text();

                    // Fetch blog posts
                    const blogIndexResponse = await fetch('blog/index.json');
                    const blogIndex = await blogIndexResponse.json();
                    blogPosts.value = blogIndex.posts;

                    showMainMenu();
                });

                watch(selectedMenuItem, () => {
                    showMainMenu();
                });

                return {
                    screenContent,
                    currentState,
                    menuItems,
                    selectedMenuItem,
                    resumeContent,
                    blogPosts,
                    currentBlogPost,
                };
            }
        });

        app.mount('#app');
    </script>
</body>
</html>
