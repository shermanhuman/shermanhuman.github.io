<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C64 Resume & Blog</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #4040e0;
            color: #a0a0ff;
            font-family: 'VT323', monospace;
            font-size: 16px;
            line-height: 1.2;
        }
        #app {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            white-space: pre-wrap;
        }
        .menu-item {
            cursor: pointer;
        }
        .menu-item.selected {
            background-color: #a0a0ff;
            color: #4040e0;
        }
        a {
            color: #a0a0ff;
        }
    </style>
</head>
<body>
    <div id="app">
        <div v-html="screenContent"></div>
    </div>

    <script>
        const { createApp, ref, onMounted, watch } = Vue;

        createApp({
            setup() {
                const screenContent = ref('');
                const currentState = ref('boot');
                const menuSelection = ref(0);
                const blogPosts = ref([]);

                const bootSequence = [
                    "**** COMMODORE 64 BASIC V2 ****\n64K RAM SYSTEM  38911 BASIC BYTES FREE\nREADY.\n",
                    "LOAD \"MENU\",8,1\n",
                    "SEARCHING FOR MENU\nLOADING\nREADY.\n"
                ];

                const typeWriter = (text, delay = 50) => {
                    return new Promise(resolve => {
                        let i = 0;
                        const interval = setInterval(() => {
                            screenContent.value += text[i];
                            i++;
                            if (i === text.length) {
                                clearInterval(interval);
                                resolve();
                            }
                        }, delay);
                    });
                };

                const loadContent = async (content) => {
                    await typeWriter(`LOAD "${content}",8,1\n`);
                    await new Promise(resolve => setTimeout(resolve, 500));
                    screenContent.value += `SEARCHING FOR ${content}\nLOADING\n`;
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    screenContent.value += "READY.\n";
                };

                const showMainMenu = () => {
                    screenContent.value = "MAIN MENU:\n\n1. VIEW RESUME\n2. VIEW BLOG\n\nUSE ARROW KEYS AND ENTER TO SELECT";
                    currentState.value = 'mainMenu';
                    menuSelection.value = 0;
                };

                const showResume = async () => {
                    await loadContent("RESUME");
                    const response = await fetch('resume.md');
                    const resumeContent = await response.text();
                    screenContent.value = marked.parse(resumeContent) + "\n\nPRESS 'B' TO RETURN TO MAIN MENU";
                    currentState.value = 'resume';
                };

                const showBlogList = async () => {
                    await loadContent("BLOG");
                    screenContent.value = "BLOG POSTS:\n\n";
                    blogPosts.value.forEach((post, index) => {
                        screenContent.value += `${index + 1}. ${post.title}\n`;
                    });
                    screenContent.value += "\nUSE ARROW KEYS AND ENTER TO SELECT\nPRESS 'B' TO RETURN TO MAIN MENU";
                    currentState.value = 'blogList';
                    menuSelection.value = 0;
                };

                const showBlogPost = async (index) => {
                    const post = blogPosts.value[index];
                    await loadContent(post.filename);
                    const response = await fetch(`blog/${post.filename}`);
                    const postContent = await response.text();
                    screenContent.value = marked.parse(postContent) + "\n\nPRESS 'B' TO RETURN TO BLOG LIST";
                    currentState.value = 'blogPost';
                };

                const handleKeydown = (event) => {
                    if (currentState.value === 'mainMenu') {
                        if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {
                            menuSelection.value = menuSelection.value === 0 ? 1 : 0;
                            showMainMenu();
                        } else if (event.key === 'Enter' || event.key === '1' || event.key === '2') {
                            if (menuSelection.value === 0 || event.key === '1') {
                                showResume();
                            } else {
                                showBlogList();
                            }
                        }
                    } else if (currentState.value === 'resume' && event.key.toLowerCase() === 'b') {
                        showMainMenu();
                    } else if (currentState.value === 'blogList') {
                        if (event.key === 'ArrowUp' && menuSelection.value > 0) {
                            menuSelection.value--;
                        } else if (event.key === 'ArrowDown' && menuSelection.value < blogPosts.value.length - 1) {
                            menuSelection.value++;
                        } else if (event.key === 'Enter') {
                            showBlogPost(menuSelection.value);
                        } else if (event.key.toLowerCase() === 'b') {
                            showMainMenu();
                        }
                    } else if (currentState.value === 'blogPost' && event.key.toLowerCase() === 'b') {
                        showBlogList();
                    }
                };

                onMounted(async () => {
                    window.addEventListener('keydown', handleKeydown);
                    
                    // Simulating boot sequence
                    screenContent.value = bootSequence[0];
                    await typeWriter(bootSequence[1]);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    screenContent.value += bootSequence[2];
                    
                    // Fetch blog posts
                    const response = await fetch('blog/index.json');
                    blogPosts.value = await response.json();
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    showMainMenu();
                });

                watch(menuSelection, () => {
                    if (currentState.value === 'mainMenu') {
                        showMainMenu();
                    } else if (currentState.value === 'blogList') {
                        showBlogList();
                    }
                });

                return {
                    screenContent
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
