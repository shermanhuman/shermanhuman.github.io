<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sherman Boyd - C64 Resume and Blog</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @font-face {
            font-family: 'C64';
            src: url('https://cdn.jsdelivr.net/gh/stylebits/webfonts@v1.0.0/c64.ttf') format('truetype');
        }
        body, button, input, textarea, select {
            background-color: #4040e0;
            color: #a0a0ff;
            font-family: 'C64', monospace;
            font-size: 16px;
            line-height: 1.6;
        }
        body {
            padding: 20px;
        }
        #app {
            max-width: 800px;
            margin: 0 auto;
        }
        .menu-item {
            padding: 5px;
            cursor: pointer;
        }
        .menu-item.active {
            background-color: #a0a0ff;
            color: #4040e0;
        }
        .menu-item:focus {
            outline: none;
        }
        .return-menu {
            margin-top: 20px;
            cursor: pointer;
        }
        * {
            outline: none !important;
        }
    </style>
</head>
<body>
    <div id="app">
        <div>
            <p v-for="(line, index) in bootLines.slice(0, bootPhase)" :key="index">{{ line }}</p>
        </div>
        <div v-if="currentScreen === 'menu'" @keydown="handleKeydown" tabindex="0" ref="menuRef">
            <p v-for="(item, index) in menuItems" :key="index" 
               :class="['menu-item', { active: index === activeMenuItem }]"
               tabindex="0">
                {{ index + 1 }}. {{ item.label }}
            </p>
            <p>USE ARROW KEYS TO NAVIGATE, ENTER TO SELECT, OR PRESS NUMBER KEY</p>
        </div>
        <div v-else-if="currentScreen === 'resume'">
            <div v-html="parsedResumeContent"></div>
            <p class="menu-item return-menu" 
               :class="{ active: activeMenuItem === 0 }"
               @click="returnToMenu" 
               @keydown="handleKeydown" 
               tabindex="0">
                RETURN TO MAIN MENU
            </p>
        </div>
        <div v-else-if="currentScreen === 'blogMenu'" @keydown="handleKeydown" tabindex="0" ref="blogMenuRef">
            <h2>BLOG POSTS:</h2>
            <p v-for="(post, index) in blogPosts" :key="index"
               :class="['menu-item', { active: index === activeMenuItem }]"
               tabindex="0">
                {{ index + 1 }}. {{ post.title }}
            </p>
            <p class="menu-item" 
               :class="{ active: activeMenuItem === blogPosts.length }"
               tabindex="0">
                {{ blogPosts.length + 1 }}. RETURN TO MAIN MENU
            </p>
            <p>USE ARROW KEYS TO NAVIGATE, ENTER TO SELECT, OR PRESS NUMBER KEY</p>
        </div>
        <div v-else-if="currentScreen === 'blogPost'">
            <div v-html="parsedBlogContent"></div>
            <p class="menu-item return-menu" 
               :class="{ active: activeMenuItem === 0 }"
               @click="returnToMenu" 
               @keydown="handleKeydown" 
               tabindex="0">
                RETURN TO MAIN MENU
            </p>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue;

        createApp({
            setup() {
                const currentScreen = ref('boot');
                const bootPhase = ref(0);
                const bootLines = [
                    '**** COMMODORE 64 BASIC V2 ****',
                    '64K RAM SYSTEM  38911 BASIC BYTES FREE',
                    'READY.',
                    'LOAD "MENU",8,1',
                    'SEARCHING FOR MENU',
                    'LOADING',
                    'READY.',
                    'RUN'
                ];
                const resumeContent = ref('');
                const blogPosts = [
                    { filename: 'first-post.prg', title: 'My First Blog Post' },
                    { filename: 'second-post.prg', title: 'Adventures in Coding' },
                    { filename: 'third-post.prg', title: 'Reflections on Technology' }
                ];

                const menuItems = [
                    { label: 'VIEW RESUME', action: () => loadContent('resume') },
                    { label: 'VIEW BLOG', action: () => loadContent('blogMenu') }
                ];

                const currentBlogContent = ref('');
                const activeMenuItem = ref(0);
                const menuRef = ref(null);
                const blogMenuRef = ref(null);

                const parsedResumeContent = computed(() => marked.parse(resumeContent.value));
                const parsedBlogContent = computed(() => marked.parse(currentBlogContent.value));

                function boot() {
                    if (bootPhase.value < 3) {
                        bootPhase.value = 3; // Instantly show first 3 lines
                        setTimeout(continueBooting, 500);
                    } else {
                        continueBooting();
                    }
                }

                function continueBooting() {
                    if (bootPhase.value < bootLines.length) {
                        bootPhase.value++;
                        setTimeout(continueBooting, 1000);
                    } else {
                        currentScreen.value = 'menu';
                        nextTick(() => {
                            menuRef.value.focus();
                        });
                    }
                }

                function loadContent(contentType) {
                    bootPhase.value = bootLines.length - 2; // Reset to 'READY.'
                    bootLines[bootLines.length - 4] = `LOAD "${contentType.toUpperCase()}",8,1`;
                    bootLines[bootLines.length - 3] = `SEARCHING FOR ${contentType.toUpperCase()}`;
                    setTimeout(() => {
                        bootPhase.value++;
                        setTimeout(() => {
                            bootPhase.value++;
                            if (contentType === 'resume') {
                                showResume();
                            } else if (contentType === 'blogMenu') {
                                showBlogMenu();
                            }
                        }, 1000);
                    }, 1000);
                }

                async function showResume() {
                    try {
                        const response = await fetch('resume.md');
                        resumeContent.value = await response.text();
                        currentScreen.value = 'resume';
                        activeMenuItem.value = 0;
                    } catch (error) {
                        console.error('Failed to load resume:', error);
                    }
                }

                function showBlogMenu() {
                    currentScreen.value = 'blogMenu';
                    activeMenuItem.value = 0;
                    nextTick(() => {
                        blogMenuRef.value.focus();
                    });
                }

                function showBlogPost(filename) {
                    loadContent(filename);
                    setTimeout(() => {
                        currentBlogContent.value = `# ${filename.replace('.prg', '')}\n\nThis is the content of the blog post.`;
                        currentScreen.value = 'blogPost';
                        activeMenuItem.value = 0;
                    }, 2000);
                }

                function returnToMenu() {
                    loadContent('menu');
                }

                function handleKeydown(event) {
                    let maxIndex;
                    switch(currentScreen.value) {
                        case 'menu':
                            maxIndex = menuItems.length - 1;
                            break;
                        case 'blogMenu':
                            maxIndex = blogPosts.length;
                            break;
                        case 'resume':
                        case 'blogPost':
                            maxIndex = 0; // Only "RETURN TO MAIN MENU" option
                            break;
                    }

                    switch(event.key) {
                        case 'ArrowUp':
                        case 'ArrowLeft':
                            activeMenuItem.value = (activeMenuItem.value - 1 + maxIndex + 1) % (maxIndex + 1);
                            break;
                        case 'ArrowDown':
                        case 'ArrowRight':
                            activeMenuItem.value = (activeMenuItem.value + 1) % (maxIndex + 1);
                            break;
                        case 'Enter':
                        case 'Return':
                            if (currentScreen.value === 'menu') {
                                menuItems[activeMenuItem.value].action();
                            } else if (currentScreen.value === 'blogMenu') {
                                if (activeMenuItem.value === blogPosts.length) {
                                    returnToMenu();
                                } else {
                                    showBlogPost(blogPosts[activeMenuItem.value].filename);
                                }
                            } else {
                                returnToMenu();
                            }
                            break;
                        default:
                            if (event.key >= '1' && event.key <= (maxIndex + 1).toString()) {
                                activeMenuItem.value = parseInt(event.key) - 1;
                                if (currentScreen.value === 'menu') {
                                    menuItems[activeMenuItem.value].action();
                                } else if (currentScreen.value === 'blogMenu') {
                                    if (activeMenuItem.value === blogPosts.length) {
                                        returnToMenu();
                                    } else {
                                        showBlogPost(blogPosts[activeMenuItem.value].filename);
                                    }
                                } else {
                                    returnToMenu();
                                }
                            }
                    }
                }

                onMounted(() => {
                    boot();
                });

                return {
                    currentScreen,
                    bootLines,
                    bootPhase,
                    parsedResumeContent,
                    blogPosts,
                    parsedBlogContent,
                    menuItems,
                    activeMenuItem,
                    handleKeydown,
                    menuRef,
                    blogMenuRef,
                    returnToMenu
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
